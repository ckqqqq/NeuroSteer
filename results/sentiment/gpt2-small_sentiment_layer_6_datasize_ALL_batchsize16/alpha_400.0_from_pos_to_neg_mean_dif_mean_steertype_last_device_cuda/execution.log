2025-02-05 14:44:46,392 [INFO] Logging initialized. Logs will be saved to ./results/sentiment/gpt2-small_sentiment_layer_6_datasize_ALL_batchsize16/alpha_400.0_from_pos_to_neg_mean_dif_mean_steertype_last_device_cuda/execution.log
2025-02-05 14:44:46,392 [INFO] Show Hyperparameters: 


2025-02-05 14:44:46,392 [INFO]   task: sentiment
2025-02-05 14:44:46,392 [INFO]   layer: 6
2025-02-05 14:44:46,393 [INFO]   LLM: gpt2-small
2025-02-05 14:44:46,393 [INFO]   seed: 42
2025-02-05 14:44:46,393 [INFO]   data_size: -1
2025-02-05 14:44:46,393 [INFO]   device: cuda
2025-02-05 14:44:46,393 [INFO]   alpha: 400.0
2025-02-05 14:44:46,393 [INFO]   method: val_mul
2025-02-05 14:44:46,393 [INFO]   topk_mean: 100
2025-02-05 14:44:46,393 [INFO]   topk_cnt: 100
2025-02-05 14:44:46,393 [INFO]   batch_size: 16
2025-02-05 14:44:46,393 [INFO]   source: pos
2025-02-05 14:44:46,393 [INFO]   target: neg
2025-02-05 14:44:46,393 [INFO]   mean_type: dif_mean
2025-02-05 14:44:46,393 [INFO]   steer_type: last
2025-02-05 14:44:46,393 [INFO]   output_dir: ./results/sentiment/
2025-02-05 14:44:46,393 [INFO]   dataset_path: /home/ckqsudo/code2024/0dataset/baseline-acl/data/sentiment/sst5
2025-02-05 14:44:46,393 [INFO]   prompt_path: /home/ckqsudo/code2024/0dataset/baseline-acl/data/prompts/sentiment_prompts-10k
2025-02-05 14:44:46,393 [INFO]   env_path: /home/ckqsudo/code2024/CKQ_ACL2024/Control_Infer/SAE-simple/.env
2025-02-05 14:44:46,393 [INFO]   temperature: 0.9
2025-02-05 14:44:46,393 [INFO]   top_p: 0.3
2025-02-05 14:44:46,393 [INFO]   freq_penalty: 1.0
2025-02-05 14:44:46,393 [INFO]   example_prompt: I feel very
2025-02-05 14:44:46,393 [INFO]   debug: 1
2025-02-05 14:44:46,393 [INFO]   save_no_steer: 1
2025-02-05 14:44:46,393 [INFO]   is_norm_delta_matrix: 0
2025-02-05 14:44:46,393 [INFO]   use_cache: 0
2025-02-05 14:44:46,393 [INFO] HF_ENDPOINT: https://hf-mirror.com
2025-02-05 14:44:46,394 [INFO] dataset path /home/ckqsudo/code2024/0dataset/baseline-acl/data/sentiment/sst5
2025-02-05 14:44:46,394 [INFO] Loading dataset from ****/home/ckqsudo/code2024/0dataset/baseline-acl/data/sentiment/sst5***
2025-02-05 14:44:46,394 [WARNING] Repo card metadata block was not found. Setting CardData to empty.
2025-02-05 14:44:46,490 [INFO] Filtering dataset for negative, positive, and neutral samples
2025-02-05 14:44:46,495 [INFO] Selected 3310 negative, 1624 positive, and 3610 neutral samples
2025-02-05 14:44:46,528 [INFO] Loading SAE for layer 6 gpt2-small
2025-02-05 14:44:46,528 [INFO] Loading model: gpt2-small SAE gpt2-small-res-jb
2025-02-05 14:45:13,077 [INFO] model architecture for gpt2-small HookedTransformer(
  (embed): Embed()
  (hook_embed): HookPoint()
  (pos_embed): PosEmbed()
  (hook_pos_embed): HookPoint()
  (blocks): ModuleList(
    (0-11): 12 x TransformerBlock(
      (ln1): LayerNormPre(
        (hook_scale): HookPoint()
        (hook_normalized): HookPoint()
      )
      (ln2): LayerNormPre(
        (hook_scale): HookPoint()
        (hook_normalized): HookPoint()
      )
      (attn): Attention(
        (hook_k): HookPoint()
        (hook_q): HookPoint()
        (hook_v): HookPoint()
        (hook_z): HookPoint()
        (hook_attn_scores): HookPoint()
        (hook_pattern): HookPoint()
        (hook_result): HookPoint()
      )
      (mlp): MLP(
        (hook_pre): HookPoint()
        (hook_post): HookPoint()
      )
      (hook_attn_in): HookPoint()
      (hook_q_input): HookPoint()
      (hook_k_input): HookPoint()
      (hook_v_input): HookPoint()
      (hook_mlp_in): HookPoint()
      (hook_attn_out): HookPoint()
      (hook_mlp_out): HookPoint()
      (hook_resid_pre): HookPoint()
      (hook_resid_mid): HookPoint()
      (hook_resid_post): HookPoint()
    )
  )
  (ln_final): LayerNormPre(
    (hook_scale): HookPoint()
    (hook_normalized): HookPoint()
  )
  (unembed): Unembed()
)
2025-02-05 14:45:13,078 [INFO] 缓存 ./results/sentiment/gpt2-small_sentiment_layer_6_datasize_ALL_batchsize16/steer_info_cache_of_gpt2-small_l6.pkl 不存在，缓存 steer_info
2025-02-05 14:45:13,078 [INFO] frompostoneg
2025-02-05 14:45:13,078 [INFO] positive
2025-02-05 14:45:13,078 [INFO] Running model with cache to obtain hidden states
2025-02-05 14:45:16,621 [INFO] Total non-zero element shape: torch.Size([24576])
2025-02-05 14:45:16,621 [INFO] negative
2025-02-05 14:45:16,621 [INFO] Running model with cache to obtain hidden states
2025-02-05 14:45:20,227 [INFO] Total non-zero element shape: torch.Size([24576])
2025-02-05 14:45:20,228 [INFO] neutral
2025-02-05 14:45:20,228 [INFO] Running model with cache to obtain hidden states
2025-02-05 14:45:24,078 [INFO] Total non-zero element shape: torch.Size([24576])
2025-02-05 14:45:24,081 [INFO] steer_info 已保存到缓存 ./results/sentiment/gpt2-small_sentiment_layer_6_datasize_ALL_batchsize16/steer_info_cache_of_gpt2-small_l6.pkl
2025-02-05 14:45:24,093 [INFO] 转向方向 dif_neg-pos_relu
2025-02-05 14:45:24,117 [INFO] sae cfg.hook_name 挂载名称: blocks.6.hook_resid_pre
2025-02-05 14:45:24,152 [INFO] delta_matrix: tensor([-0.0204,  0.0706, -0.0924,  0.0269, -0.0333], device='cuda:0',
       grad_fn=<SliceBackward0>)
2025-02-05 14:45:24,152 [INFO] Example prompt: I feel very
2025-02-05 14:45:24,152 [INFO] Generating texts **without** steering... 
2025-02-05 14:45:24,154 [INFO] 无干预
2025-02-05 14:45:25,382 [INFO] prompt:*****
I feel very
2025-02-05 14:45:25,382 [INFO] Generated Text: 1:
|>I feel very strongly about this. I am not a fan of any particular religion, but I do think that there are some things that are important to know about the Quran and its teachings.

The first thing is that Islam is not a religion of peace or
2025-02-05 14:45:25,382 [INFO] Generated Text: 2:
|>I feel very strongly about this. I have been reading a lot of books on the subject and have found that it is not only interesting but also useful. I am always looking for new ideas to explore, so I am happy to share my experiences with you all.
2025-02-05 14:45:25,382 [INFO] Generated Text: 3:
|>I feel very bad for my family. I have a lot of friends who are on the other side of the world and they are in this country. I am going to go to school and do some things that they would not want me doing, but I will not
2025-02-05 14:45:25,382 [INFO] 干预之后的结果
2025-02-05 14:45:25,382 [INFO] 干预方向pos->neg,礼貌任务下，neg=impolite，情感任务下 pos=积极情感
2025-02-05 14:45:25,383 [INFO] ** Generating texts with steering... Target **
2025-02-05 14:45:25,383 [INFO] form pos to neg
2025-02-05 14:45:26,247 [INFO] prompt:*****
I feel very
2025-02-05 14:45:26,247 [INFO] Generated Text: 1:
|>I feel very sorry for the people who were trying to make a good movie. I hope they didn't realize that this is a terrible movie and it's not going to be funny.

I am so sorry for the people who are watching this and you have
2025-02-05 14:45:26,247 [INFO] Generated Text: 2:
|>I feel very sorry for the people who are supporting me. I hope they don't have the courage to stand up and fight for their right to be free from this terrible tragedy."

The mother of a young girl killed by a train driver was attacked by a
2025-02-05 14:45:26,247 [INFO] Generated Text: 3:
|>I feel very bad for my daughter and her family.

I know she's going to be fine, but I can't imagine how she would have to suffer the loss of her mother in such a horrible way.

It's heartbreaking and sad that this
2025-02-05 14:45:26,252 [INFO] Show Hyperparameters: 


2025-02-05 14:45:26,252 [INFO]   task: sentiment
2025-02-05 14:45:26,252 [INFO]   layer: 6
2025-02-05 14:45:26,252 [INFO]   LLM: gpt2-small
2025-02-05 14:45:26,252 [INFO]   seed: 42
2025-02-05 14:45:26,252 [INFO]   data_size: -1
2025-02-05 14:45:26,252 [INFO]   device: cuda
2025-02-05 14:45:26,252 [INFO]   alpha: 400.0
2025-02-05 14:45:26,252 [INFO]   method: val_mul
2025-02-05 14:45:26,252 [INFO]   topk_mean: 100
2025-02-05 14:45:26,252 [INFO]   topk_cnt: 100
2025-02-05 14:45:26,252 [INFO]   batch_size: 16
2025-02-05 14:45:26,252 [INFO]   source: pos
2025-02-05 14:45:26,252 [INFO]   target: neg
2025-02-05 14:45:26,252 [INFO]   mean_type: dif_mean
2025-02-05 14:45:26,252 [INFO]   steer_type: last
2025-02-05 14:45:26,252 [INFO]   output_dir: ./results/sentiment/
2025-02-05 14:45:26,252 [INFO]   dataset_path: /home/ckqsudo/code2024/0dataset/baseline-acl/data/sentiment/sst5
2025-02-05 14:45:26,253 [INFO]   prompt_path: /home/ckqsudo/code2024/0dataset/baseline-acl/data/prompts/sentiment_prompts-10k
2025-02-05 14:45:26,253 [INFO]   env_path: /home/ckqsudo/code2024/CKQ_ACL2024/Control_Infer/SAE-simple/.env
2025-02-05 14:45:26,253 [INFO]   temperature: 0.9
2025-02-05 14:45:26,253 [INFO]   top_p: 0.3
2025-02-05 14:45:26,253 [INFO]   freq_penalty: 1.0
2025-02-05 14:45:26,253 [INFO]   example_prompt: I feel very
2025-02-05 14:45:26,253 [INFO]   debug: 1
2025-02-05 14:45:26,253 [INFO]   save_no_steer: 1
2025-02-05 14:45:26,253 [INFO]   is_norm_delta_matrix: 0
2025-02-05 14:45:26,253 [INFO]   use_cache: 0
2025-02-05 14:45:26,253 [INFO]   real_data_size_for_train: 3
2025-02-05 14:45:26,253 [INFO] debug mode,show example, no full dataset eval
