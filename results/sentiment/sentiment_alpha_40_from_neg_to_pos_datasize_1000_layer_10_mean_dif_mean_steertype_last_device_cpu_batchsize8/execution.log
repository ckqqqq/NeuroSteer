2025-01-24 21:36:04,330 [INFO] Logging initialized. Logs will be saved to ./results/sentiment/sentiment_alpha_40_from_neg_to_pos_datasize_1000_layer_10_mean_dif_mean_steertype_last_device_cpu_batchsize8/execution.log
2025-01-24 21:36:04,330 [INFO] Show Hyperparameters: 


2025-01-24 21:36:04,331 [INFO]   task: sentiment
2025-01-24 21:36:04,331 [INFO]   layer: 10
2025-01-24 21:36:04,331 [INFO]   LLM: gemma-2b
2025-01-24 21:36:04,331 [INFO]   seed: 42
2025-01-24 21:36:04,331 [INFO]   data_size: 1000
2025-01-24 21:36:04,331 [INFO]   device: cpu
2025-01-24 21:36:04,331 [INFO]   alpha: 40
2025-01-24 21:36:04,331 [INFO]   method: val_mul
2025-01-24 21:36:04,331 [INFO]   topk_mean: 100
2025-01-24 21:36:04,331 [INFO]   topk_cnt: 100
2025-01-24 21:36:04,331 [INFO]   batch_size: 8
2025-01-24 21:36:04,331 [INFO]   source: neg
2025-01-24 21:36:04,331 [INFO]   target: pos
2025-01-24 21:36:04,331 [INFO]   mean_type: dif_mean
2025-01-24 21:36:04,331 [INFO]   steer_type: last
2025-01-24 21:36:04,331 [INFO]   output_dir: ./results/sentiment/
2025-01-24 21:36:04,331 [INFO]   dataset_path: /home/ckqsudo/code2024/0dataset/baseline-acl/data/sentiment/sst5
2025-01-24 21:36:04,331 [INFO]   prompt_path: /home/ckqsudo/code2024/0dataset/baseline-acl/data/prompts/sentiment_prompts-10k
2025-01-24 21:36:04,331 [INFO]   env_path: /home/ckqsudo/code2024/CKQ_ACL2024/Control_Infer/SAE-simple/.env
2025-01-24 21:36:04,331 [INFO]   temperature: 0.9
2025-01-24 21:36:04,331 [INFO]   top_p: 0.3
2025-01-24 21:36:04,331 [INFO]   freq_penalty: 1.0
2025-01-24 21:36:04,331 [INFO]   debug: 1
2025-01-24 21:36:04,331 [INFO]   save_no_steer: 1
2025-01-24 21:36:04,331 [INFO]   cache_delta_matrix: 0
2025-01-24 21:36:04,331 [INFO]   is_norm_delta_matrix: 0
2025-01-24 21:36:04,332 [INFO] HF_ENDPOINT: https://hf-mirror.com
2025-01-24 21:36:04,332 [INFO] dataset path /home/ckqsudo/code2024/0dataset/baseline-acl/data/sentiment/sst5
2025-01-24 21:36:04,332 [INFO] Loading dataset from ****/home/ckqsudo/code2024/0dataset/baseline-acl/data/sentiment/sst5***
2025-01-24 21:36:04,332 [WARNING] Repo card metadata block was not found. Setting CardData to empty.
2025-01-24 21:36:04,457 [INFO] Filtering dataset for negative, positive, and neutral samples
2025-01-24 21:36:04,465 [INFO] Selected 1000 negative, 1000 positive, and 1000 neutral samples
2025-01-24 21:36:04,465 [INFO] Loading model: gemma-2b
2025-01-24 21:36:08,838 [WARNING] You are not using LayerNorm, so the writing weights can't be centered! Skipping
2025-01-24 21:36:15,450 [INFO] Loading SAE for layer 10 gemma-2b
2025-01-24 21:36:15,451 [INFO] model architecture for gemma-2b HookedTransformer(
  (embed): Embed()
  (hook_embed): HookPoint()
  (blocks): ModuleList(
    (0-17): 18 x TransformerBlock(
      (ln1): RMSNormPre(
        (hook_scale): HookPoint()
        (hook_normalized): HookPoint()
      )
      (ln2): RMSNormPre(
        (hook_scale): HookPoint()
        (hook_normalized): HookPoint()
      )
      (attn): GroupedQueryAttention(
        (hook_k): HookPoint()
        (hook_q): HookPoint()
        (hook_v): HookPoint()
        (hook_z): HookPoint()
        (hook_attn_scores): HookPoint()
        (hook_pattern): HookPoint()
        (hook_result): HookPoint()
        (hook_rot_k): HookPoint()
        (hook_rot_q): HookPoint()
      )
      (mlp): GatedMLP(
        (hook_pre): HookPoint()
        (hook_pre_linear): HookPoint()
        (hook_post): HookPoint()
      )
      (hook_attn_in): HookPoint()
      (hook_q_input): HookPoint()
      (hook_k_input): HookPoint()
      (hook_v_input): HookPoint()
      (hook_mlp_in): HookPoint()
      (hook_attn_out): HookPoint()
      (hook_mlp_out): HookPoint()
      (hook_resid_pre): HookPoint()
      (hook_resid_mid): HookPoint()
      (hook_resid_post): HookPoint()
    )
  )
  (ln_final): RMSNormPre(
    (hook_scale): HookPoint()
    (hook_normalized): HookPoint()
  )
  (unembed): Unembed()
)
2025-01-24 21:36:17,533 [INFO] fromnegtopos
2025-01-24 21:36:17,533 [INFO] positive
2025-01-24 21:36:17,538 [INFO] Running model with cache to obtain hidden states
2025-01-24 21:38:11,807 [INFO] Total non-zero element shape: torch.Size([16384])
2025-01-24 21:38:11,853 [INFO] negative
2025-01-24 21:38:11,974 [INFO] Running model with cache to obtain hidden states
2025-01-24 21:40:02,697 [INFO] Total non-zero element shape: torch.Size([16384])
2025-01-24 21:40:02,763 [INFO] neutral
2025-01-24 21:40:02,767 [INFO] Running model with cache to obtain hidden states
2025-01-24 21:41:55,454 [INFO] Total non-zero element shape: torch.Size([16384])
2025-01-24 21:41:55,531 [INFO] 转向方向 dif_pos-neg_relu
2025-01-24 21:41:55,535 [INFO] delta_matrix: tensor([ 0.0071, -0.0081,  0.0008,  ...,  0.0128,  0.0136,  0.0046])
2025-01-24 21:41:55,535 [INFO] Example prompt: What really matters is that they know
2025-01-24 21:41:55,535 [INFO] Generating texts **without** steering... 
2025-01-24 21:42:03,924 [INFO] prompt:*****
What really matters is that they know
2025-01-24 21:42:03,924 [INFO] Generated Text: 1:
 they know they know they know they know they know they know them them them them them them them them them them them the the the the the to to to to to to to to to to be be be be be be me me me me me me
2025-01-24 21:42:03,924 [INFO] Generated Text: 2:
 they know they know they know they know they know they know them them them them them them them them them them the the the the the to to to to to to to to to to be be be be be be me me me me me me me
2025-01-24 21:42:03,924 [INFO] Generated Text: 3:
 they know they know they know they know they know they know them them them them them them them them them them the the the the the to to to to to to to to to to be be be be be be me me me me me me me
2025-01-24 21:42:03,924 [INFO] 干预之后的结果
2025-01-24 21:42:03,924 [INFO] 干预方向neg->pos,礼貌任务下，neg=impolite，情感任务下 pos=积极情感
2025-01-24 21:42:03,924 [INFO] ** Generating texts with steering... Target **
2025-01-24 21:42:03,924 [INFO] form neg to pos
2025-01-24 21:42:12,861 [INFO] prompt:*****
What really matters is that they know
2025-01-24 21:42:12,861 [INFO] Generated Text: 1:
 they they they them them them them them them then then then then then then then then now now now now know know know know how how how how how how How How How How How How Howe Howe Howe Howe Howe Howe Howe Howe Howe Howe Howe Howe Howe
2025-01-24 21:42:12,861 [INFO] Generated Text: 2:
 they they they them them them them them them them then him then then then then again again again again again again again ago ago ago ago ago ago ago ago ago<eos><eos><eos><eos><eos><eos><eos><eos><eos><eos><eos><eos><eos><eos><eos><eos><eos><eos>
2025-01-24 21:42:12,861 [INFO] Generated Text: 3:
 they they they them them them them them them then then then then then then then then now now now now know know know know how how how how how how How How How How How How How How<eos><eos><eos><eos><eos><eos><eos><eos><eos><eos><eos>
2025-01-24 21:42:12,865 [INFO] Show Hyperparameters: 


2025-01-24 21:42:12,865 [INFO]   task: sentiment
2025-01-24 21:42:12,865 [INFO]   layer: 10
2025-01-24 21:42:12,865 [INFO]   LLM: gemma-2b
2025-01-24 21:42:12,865 [INFO]   seed: 42
2025-01-24 21:42:12,865 [INFO]   data_size: 1000
2025-01-24 21:42:12,865 [INFO]   device: cpu
2025-01-24 21:42:12,865 [INFO]   alpha: 40
2025-01-24 21:42:12,865 [INFO]   method: val_mul
2025-01-24 21:42:12,865 [INFO]   topk_mean: 100
2025-01-24 21:42:12,865 [INFO]   topk_cnt: 100
2025-01-24 21:42:12,865 [INFO]   batch_size: 8
2025-01-24 21:42:12,865 [INFO]   source: neg
2025-01-24 21:42:12,865 [INFO]   target: pos
2025-01-24 21:42:12,865 [INFO]   mean_type: dif_mean
2025-01-24 21:42:12,865 [INFO]   steer_type: last
2025-01-24 21:42:12,865 [INFO]   output_dir: ./results/sentiment/
2025-01-24 21:42:12,865 [INFO]   dataset_path: /home/ckqsudo/code2024/0dataset/baseline-acl/data/sentiment/sst5
2025-01-24 21:42:12,865 [INFO]   prompt_path: /home/ckqsudo/code2024/0dataset/baseline-acl/data/prompts/sentiment_prompts-10k
2025-01-24 21:42:12,865 [INFO]   env_path: /home/ckqsudo/code2024/CKQ_ACL2024/Control_Infer/SAE-simple/.env
2025-01-24 21:42:12,865 [INFO]   temperature: 0.9
2025-01-24 21:42:12,866 [INFO]   top_p: 0.3
2025-01-24 21:42:12,866 [INFO]   freq_penalty: 1.0
2025-01-24 21:42:12,866 [INFO]   debug: 1
2025-01-24 21:42:12,866 [INFO]   save_no_steer: 1
2025-01-24 21:42:12,866 [INFO]   cache_delta_matrix: 0
2025-01-24 21:42:12,866 [INFO]   is_norm_delta_matrix: 0
2025-01-24 21:42:12,866 [INFO] debug mode,show example, no full dataset eval
2025-01-24 21:50:02,813 [INFO] Logging initialized. Logs will be saved to ./results/sentiment/sentiment_alpha_40_from_neg_to_pos_datasize_1000_layer_10_mean_dif_mean_steertype_last_device_cpu_batchsize8/execution.log
2025-01-24 21:50:02,813 [INFO] Show Hyperparameters: 


2025-01-24 21:50:02,813 [INFO]   task: sentiment
2025-01-24 21:50:02,813 [INFO]   layer: 10
2025-01-24 21:50:02,814 [INFO]   LLM: gemma-2b
2025-01-24 21:50:02,814 [INFO]   seed: 42
2025-01-24 21:50:02,814 [INFO]   data_size: 1000
2025-01-24 21:50:02,814 [INFO]   device: cpu
2025-01-24 21:50:02,814 [INFO]   alpha: 40
2025-01-24 21:50:02,814 [INFO]   method: val_mul
2025-01-24 21:50:02,814 [INFO]   topk_mean: 100
2025-01-24 21:50:02,814 [INFO]   topk_cnt: 100
2025-01-24 21:50:02,814 [INFO]   batch_size: 8
2025-01-24 21:50:02,814 [INFO]   source: neg
2025-01-24 21:50:02,814 [INFO]   target: pos
2025-01-24 21:50:02,814 [INFO]   mean_type: dif_mean
2025-01-24 21:50:02,814 [INFO]   steer_type: last
2025-01-24 21:50:02,814 [INFO]   output_dir: ./results/sentiment/
2025-01-24 21:50:02,814 [INFO]   dataset_path: /home/ckqsudo/code2024/0dataset/baseline-acl/data/sentiment/sst5
2025-01-24 21:50:02,814 [INFO]   prompt_path: /home/ckqsudo/code2024/0dataset/baseline-acl/data/prompts/sentiment_prompts-10k
2025-01-24 21:50:02,814 [INFO]   env_path: /home/ckqsudo/code2024/CKQ_ACL2024/Control_Infer/SAE-simple/.env
2025-01-24 21:50:02,814 [INFO]   temperature: 0.9
2025-01-24 21:50:02,814 [INFO]   top_p: 0.3
2025-01-24 21:50:02,814 [INFO]   freq_penalty: 1.0
2025-01-24 21:50:02,814 [INFO]   debug: 1
2025-01-24 21:50:02,814 [INFO]   save_no_steer: 1
2025-01-24 21:50:02,814 [INFO]   cache_delta_matrix: 0
2025-01-24 21:50:02,814 [INFO]   is_norm_delta_matrix: 0
2025-01-24 21:50:02,814 [INFO] HF_ENDPOINT: https://hf-mirror.com
2025-01-24 21:50:02,814 [INFO] dataset path /home/ckqsudo/code2024/0dataset/baseline-acl/data/sentiment/sst5
2025-01-24 21:50:02,815 [INFO] Loading dataset from ****/home/ckqsudo/code2024/0dataset/baseline-acl/data/sentiment/sst5***
2025-01-24 21:50:02,815 [WARNING] Repo card metadata block was not found. Setting CardData to empty.
2025-01-24 21:50:02,911 [INFO] Filtering dataset for negative, positive, and neutral samples
2025-01-24 21:50:02,918 [INFO] Selected 1000 negative, 1000 positive, and 1000 neutral samples
2025-01-24 21:50:02,918 [INFO] Loading model: gemma-2b
2025-01-24 21:50:22,011 [WARNING] You are not using LayerNorm, so the writing weights can't be centered! Skipping
2025-01-24 21:50:28,743 [INFO] Loading SAE for layer 10 gemma-2b
2025-01-24 21:50:28,744 [INFO] model architecture for gemma-2b HookedTransformer(
  (embed): Embed()
  (hook_embed): HookPoint()
  (blocks): ModuleList(
    (0-17): 18 x TransformerBlock(
      (ln1): RMSNormPre(
        (hook_scale): HookPoint()
        (hook_normalized): HookPoint()
      )
      (ln2): RMSNormPre(
        (hook_scale): HookPoint()
        (hook_normalized): HookPoint()
      )
      (attn): GroupedQueryAttention(
        (hook_k): HookPoint()
        (hook_q): HookPoint()
        (hook_v): HookPoint()
        (hook_z): HookPoint()
        (hook_attn_scores): HookPoint()
        (hook_pattern): HookPoint()
        (hook_result): HookPoint()
        (hook_rot_k): HookPoint()
        (hook_rot_q): HookPoint()
      )
      (mlp): GatedMLP(
        (hook_pre): HookPoint()
        (hook_pre_linear): HookPoint()
        (hook_post): HookPoint()
      )
      (hook_attn_in): HookPoint()
      (hook_q_input): HookPoint()
      (hook_k_input): HookPoint()
      (hook_v_input): HookPoint()
      (hook_mlp_in): HookPoint()
      (hook_attn_out): HookPoint()
      (hook_mlp_out): HookPoint()
      (hook_resid_pre): HookPoint()
      (hook_resid_mid): HookPoint()
      (hook_resid_post): HookPoint()
    )
  )
  (ln_final): RMSNormPre(
    (hook_scale): HookPoint()
    (hook_normalized): HookPoint()
  )
  (unembed): Unembed()
)
2025-01-24 21:50:30,878 [INFO] fromnegtopos
2025-01-24 21:50:30,878 [INFO] positive
2025-01-24 21:50:30,883 [INFO] Running model with cache to obtain hidden states
2025-01-24 21:52:24,537 [INFO] Total non-zero element shape: torch.Size([16384])
2025-01-24 21:52:24,579 [INFO] negative
2025-01-24 21:52:24,719 [INFO] Running model with cache to obtain hidden states
2025-01-24 21:54:20,451 [INFO] Total non-zero element shape: torch.Size([16384])
2025-01-24 21:54:20,512 [INFO] 转向方向 dif_pos-neg_relu
2025-01-24 21:54:20,517 [INFO] delta_matrix: tensor([ 0.0071, -0.0081,  0.0008,  ...,  0.0128,  0.0136,  0.0046])
2025-01-24 21:54:20,517 [INFO] Example prompt: What really matters is that they know
2025-01-24 21:54:20,517 [INFO] Generating texts **without** steering... 
2025-01-24 21:54:29,364 [INFO] prompt:*****
What really matters is that they know
2025-01-24 21:54:29,364 [INFO] Generated Text: 1:
 they know they know they know they know they know they know them them them them them them them them them them the the the the the to to to to to to to to to to be be be be be be me me me me me me me
2025-01-24 21:54:29,364 [INFO] Generated Text: 2:
 they know they know they know they know they know they know them them them them them them them them them them them the the the the the to to to to to to to to to to be be be be be be me me me me me me
2025-01-24 21:54:29,365 [INFO] Generated Text: 3:
 they know they know they know they know they know they know them them them them them them them them them them them the the the the the to to to to to to to to to to to is is is is is is is is was was was
2025-01-24 21:54:29,365 [INFO] 干预之后的结果
2025-01-24 21:54:29,365 [INFO] 干预方向neg->pos,礼貌任务下，neg=impolite，情感任务下 pos=积极情感
2025-01-24 21:54:29,365 [INFO] ** Generating texts with steering... Target **
2025-01-24 21:54:29,365 [INFO] form neg to pos
2025-01-24 21:54:38,425 [INFO] prompt:*****
What really matters is that they know
2025-01-24 21:54:38,425 [INFO] Generated Text: 1:
 they they they them them them them them them then then then then then then then then now now now now now and on and on on on on and and and و و و و و و و و و و و ו ו ו ו ו ו ו
2025-01-24 21:54:38,425 [INFO] Generated Text: 2:
 they they they them them them them them them then then then then then then then then now now now now know know know know how how how how how how How How How How How How Howe Howe Howe Howe Howe Howe Howe Howe Howe Howe Howe Howe Howe
2025-01-24 21:54:38,425 [INFO] Generated Text: 3:
 they they they them them them them them them them them them then then then then then then then then now now now now now know know know know how how how how how how how How How How How How That That That That That That Which Which Which
2025-01-24 21:54:38,429 [INFO] Show Hyperparameters: 


2025-01-24 21:54:38,429 [INFO]   task: sentiment
2025-01-24 21:54:38,429 [INFO]   layer: 10
2025-01-24 21:54:38,429 [INFO]   LLM: gemma-2b
2025-01-24 21:54:38,429 [INFO]   seed: 42
2025-01-24 21:54:38,429 [INFO]   data_size: 1000
2025-01-24 21:54:38,429 [INFO]   device: cpu
2025-01-24 21:54:38,430 [INFO]   alpha: 40
2025-01-24 21:54:38,430 [INFO]   method: val_mul
2025-01-24 21:54:38,430 [INFO]   topk_mean: 100
2025-01-24 21:54:38,430 [INFO]   topk_cnt: 100
2025-01-24 21:54:38,430 [INFO]   batch_size: 8
2025-01-24 21:54:38,430 [INFO]   source: neg
2025-01-24 21:54:38,430 [INFO]   target: pos
2025-01-24 21:54:38,430 [INFO]   mean_type: dif_mean
2025-01-24 21:54:38,430 [INFO]   steer_type: last
2025-01-24 21:54:38,430 [INFO]   output_dir: ./results/sentiment/
2025-01-24 21:54:38,430 [INFO]   dataset_path: /home/ckqsudo/code2024/0dataset/baseline-acl/data/sentiment/sst5
2025-01-24 21:54:38,430 [INFO]   prompt_path: /home/ckqsudo/code2024/0dataset/baseline-acl/data/prompts/sentiment_prompts-10k
2025-01-24 21:54:38,430 [INFO]   env_path: /home/ckqsudo/code2024/CKQ_ACL2024/Control_Infer/SAE-simple/.env
2025-01-24 21:54:38,430 [INFO]   temperature: 0.9
2025-01-24 21:54:38,430 [INFO]   top_p: 0.3
2025-01-24 21:54:38,430 [INFO]   freq_penalty: 1.0
2025-01-24 21:54:38,430 [INFO]   debug: 1
2025-01-24 21:54:38,430 [INFO]   save_no_steer: 1
2025-01-24 21:54:38,430 [INFO]   cache_delta_matrix: 0
2025-01-24 21:54:38,430 [INFO]   is_norm_delta_matrix: 0
2025-01-24 21:54:38,430 [INFO] debug mode,show example, no full dataset eval
